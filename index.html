<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìŠ¤ë§ˆíŠ¸ ëƒ‰ì¥ê³ </title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@17/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans KR', sans-serif; background-color: #f8f9fa; }
        .quantity-full { background-color: #28a745; }
        .quantity-some { background-color: #ffc107; color: #212529; }
        .expiry-urgent { color: #dc3545; font-weight: bold; }
        .expiry-warning { color: #fd7e14; font-weight: bold; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;

        // --- API í†µì‹  í•¨ìˆ˜ ---
        const API_BASE_URL = 'https://nangzango.onrender.com/api'; // ë°±ì—”ë“œ ì„œë²„ ì£¼ì†Œ
        const USER_ID = 'user01';

        const fetchIngredients = async () => {
            try {
                const response = await fetch(`${API_BASE_URL}/ingredients/${USER_ID}`);
                if (!response.ok) throw new Error('ì„œë²„ ì˜¤ë¥˜');
                return await response.json();
            } catch (error) {
                console.error("Fetch Ingredients Error:", error);
                return [];
            }
        };

        const addIngredientAPI = async (name, quantity) => {
            try {
                const response = await fetch(`${API_BASE_URL}/ingredients/${USER_ID}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, quantity, storageMethod: 'ëƒ‰ì¥', isOpened: false }),
                });
                if (!response.ok) throw new Error('ì„œë²„ ì˜¤ë¥˜');
                return await response.json();
            } catch (error) {
                console.error("Add Ingredient Error:", error);
                return null;
            }
        };
        
        const deleteIngredientAPI = async (ingredientId) => {
            try {
                const response = await fetch(`${API_BASE_URL}/ingredients/${USER_ID}/${ingredientId}`, {
                    method: 'DELETE',
                });
                return response.ok;
            } catch (error) {
                console.error("Delete Ingredient Error:", error);
                return false;
            }
        };

        // --- ì»´í¬ë„ŒíŠ¸ ---
        function Header({ setPage }) {
            return (
                <header className="bg-white shadow-md">
                    <nav className="container mx-auto px-6 py-3 flex justify-between items-center">
                        <div className="text-xl font-bold text-gray-800 cursor-pointer" onClick={() => setPage('home')}>
                            ğŸ¥— ìŠ¤ë§ˆíŠ¸ ëƒ‰ì¥ê³ 
                        </div>
                        <div>
                            <button onClick={() => setPage('home')} className="text-gray-800 hover:text-blue-600 px-3 py-2">í™ˆ</button>
                            <button onClick={() => setPage('ingredients')} className="text-gray-800 hover:text-blue-600 px-3 py-2">ì¬ë£Œ ê´€ë¦¬</button>
                        </div>
                    </nav>
                </header>
            );
        }

        function HomeScreen() {
            return (
                <div className="text-center p-10">
                    <h1 className="text-4xl font-bold mb-4">ë‚´ ëƒ‰ì¥ê³ ë¥¼ ìœ„í•œ ë§ì¶¤ ìš”ë¦¬</h1>
                    <p className="text-lg text-gray-600 mb-8">ë³´ìœ í•œ ì¬ë£Œë¡œ ë§Œë“¤ ìˆ˜ ìˆëŠ” ìµœê³ ì˜ ë ˆì‹œí”¼ë¥¼ ì¶”ì²œí•´ ë“œë¦½ë‹ˆë‹¤.</p>
                    <button className="bg-blue-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-blue-700 transition-colors text-lg">
                        AI ì¶”ì²œ ë°›ê¸° ğŸ‘¨â€ğŸ³
                    </button>
                </div>
            );
        }

        function IngredientsScreen({ setPage }) {
            const [ingredients, setIngredients] = useState([]);
            const [loading, setLoading] = useState(true);

            const loadIngredients = useCallback(async () => {
                setLoading(true);
                const data = await fetchIngredients();
                setIngredients(data);
                setLoading(false);
            }, []);

            useEffect(() => {
                loadIngredients();
            }, [loadIngredients]);

            const handleDelete = async (ingredientId) => {
                if (confirm("ì •ë§ë¡œ ì´ ì¬ë£Œë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                    const success = await deleteIngredientAPI(ingredientId);
                    if (success) {
                        loadIngredients();
                    } else {
                        alert("ì˜¤ë¥˜: ì¬ë£Œë¥¼ ì‚­ì œí•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
                    }
                }
            };

            if (loading) {
                return <div className="text-center p-10">ë¡œë”© ì¤‘...</div>;
            }

            return (
                <div className="p-4 md:p-8">
                    <div className="flex justify-between items-center mb-6">
                        <h1 className="text-3xl font-bold">ë‚´ ëƒ‰ì¥ê³ </h1>
                        <button onClick={() => setPage('addIngredient')} className="bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors">
                            + ì¬ë£Œ ì¶”ê°€
                        </button>
                    </div>
                    <div className="bg-white rounded-lg shadow overflow-hidden">
                        <ul className="divide-y divide-gray-200">
                            {ingredients.length > 0 ? ingredients.map(item => (
                                <li key={item._id} className="p-4 flex justify-between items-center hover:bg-gray-50">
                                    <div>
                                        <span className="text-lg font-medium">{item.name}</span>
                                        <span className={`ml-3 text-xs font-bold text-white py-1 px-2 rounded-full ${item.quantity === 'ìˆìŒ' ? 'quantity-full' : 'quantity-some'}`}>{item.quantity}</span>
                                    </div>
                                    <div className="flex items-center">
                                        <span className={`text-sm mr-4 ${item.daysLeft <= 3 ? 'expiry-urgent' : item.daysLeft <= 7 ? 'expiry-warning' : ''}`}>
                                            {item.daysLeft > 0 ? `${item.daysLeft}ì¼ ë‚¨ìŒ` : 'ê¸°í•œ ë§Œë£Œ'}
                                        </span>
                                        <button onClick={() => handleDelete(item._id)} className="text-red-500 hover:text-red-700">ì‚­ì œ</button>
                                    </div>
                                </li>
                            )) : <li className="p-4 text-center text-gray-500">ëƒ‰ì¥ê³ ê°€ ë¹„ì–´ìˆì–´ìš”!</li>}
                        </ul>
                    </div>
                </div>
            );
        }

        function AddIngredientScreen({ setPage }) {
            const [name, setName] = useState('');
            const [quantity, setQuantity] = useState('ìˆìŒ');
            const [loading, setLoading] = useState(false);

            const handleSave = async () => {
                if (!name.trim()) {
                    alert("ì¬ë£Œ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                    return;
                }
                setLoading(true);
                const newIngredient = await addIngredientAPI(name, quantity);
                setLoading(false);

                if (newIngredient) {
                    setPage('ingredients');
                } else {
                    alert("ì˜¤ë¥˜: ì¬ë£Œë¥¼ ì¶”ê°€í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
                }
            };

            return (
                <div className="p-4 md:p-8 max-w-lg mx-auto">
                     <h1 className="text-3xl font-bold mb-6">ìƒˆ ì¬ë£Œ ì¶”ê°€</h1>
                     <div className="bg-white p-8 rounded-lg shadow">
                        <div className="mb-6">
                            <label htmlFor="name" className="block text-sm font-medium text-gray-700 mb-1">ì¬ë£Œ ì´ë¦„</label>
                            <input
                                type="text"
                                id="name"
                                value={name}
                                onChange={(e) => setName(e.target.value)}
                                className="w-full p-2 border border-gray-300 rounded-md shadow-sm"
                                placeholder="ì˜ˆ: ë¼ì§€ê³ ê¸°"
                            />
                        </div>
                        <div className="mb-8">
                             <label className="block text-sm font-medium text-gray-700 mb-2">ìˆ˜ëŸ‰</label>
                             <div className="flex space-x-2">
                                {['ìˆìŒ', 'ìíˆ¬ë¦¬', 'ì—†ìŒ'].map(q => (
                                    <button
                                        key={q}
                                        onClick={() => setQuantity(q)}
                                        className={`flex-1 py-2 rounded-md border transition-colors ${quantity === q ? 'bg-blue-600 text-white border-blue-600' : 'bg-white text-gray-700 border-gray-300 hover:bg-gray-100'}`}
                                    >
                                        {q}
                                    </button>
                                ))}
                             </div>
                        </div>
                        <div className="flex justify-end space-x-3">
                            <button onClick={() => setPage('ingredients')} className="bg-gray-200 text-gray-800 font-bold py-2 px-4 rounded-lg hover:bg-gray-300">ì·¨ì†Œ</button>
                            <button onClick={handleSave} disabled={loading} className="bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700 disabled:bg-blue-300">
                                {loading ? 'ì €ì¥ ì¤‘...' : 'ì €ì¥í•˜ê¸°'}
                            </button>
                        </div>
                     </div>
                </div>
            )
        }


        function App() {
            const [page, setPage] = useState('home');

            const renderPage = () => {
                switch (page) {
                    case 'ingredients':
                        return <IngredientsScreen setPage={setPage} />;
                    case 'addIngredient':
                        return <AddIngredientScreen setPage={setPage} />;
                    case 'home':
                    default:
                        return <HomeScreen />;
                }
            };

            return (
                <div>
                    <Header setPage={setPage} />
                    <main className="container mx-auto px-6 py-8">
                        {renderPage()}
                    </main>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
